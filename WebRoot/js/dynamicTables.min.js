(function(a){function n(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode=function(a){var f="",e,b,l,k,c,d,h=0;for(a=_utf8_encode(a);h<a.length;)e=a.charCodeAt(h++),b=a.charCodeAt(h++),l=a.charCodeAt(h++),k=e>>2,e=(e&3)<<4|b>>4,c=(b&15)<<2|l>>6,d=l&63,isNaN(b)?c=d=64:isNaN(l)&&(d=64),f=f+_keyStr.charAt(k)+_keyStr.charAt(e)+_keyStr.charAt(c)+_keyStr.charAt(d);return f};this.decode=function(a){var f="",e,b,l,k,c,d=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<a.length;)e=_keyStr.indexOf(a.charAt(d++)),b=_keyStr.indexOf(a.charAt(d++)),k=_keyStr.indexOf(a.charAt(d++)),c=_keyStr.indexOf(a.charAt(d++)),e=e<<2|b>>4,b=(b&15)<<4|k>>2,l=(k&3)<<6|c,f+=String.fromCharCode(e),64!=k&&(f+=String.fromCharCode(b)),64!=c&&(f+=String.fromCharCode(l));return f=_utf8_decode(f)};_utf8_encode=function(a){a=a.replace(/\r\n/g,"\n");for(var f="",e=0;e<a.length;e++){var b=a.charCodeAt(e);128>b?f+=String.fromCharCode(b):(127<b&&2048>b?f+=String.fromCharCode(b>>6|192):(f+=String.fromCharCode(b>>12|224),f+=String.fromCharCode(b>>6&63|128)),f+=String.fromCharCode(b&63|128))}return f};_utf8_decode=function(a){var f="",e=0,b;for(c1=c2=0;e<a.length;)b=a.charCodeAt(e),128>b?(f+=String.fromCharCode(b),e++):191<b&&224>b?(c2=a.charCodeAt(e+1),f+=String.fromCharCode((b&31)<<6|c2&63),e+=2):(c2=a.charCodeAt(e+1),c3=a.charCodeAt(e+2),f+=String.fromCharCode((b&15)<<12|(c2&63)<<6|c3&63),e+=3);return f}}a.fn.dynamicTables=function(l){function f(){a(k).children().eq(0).children("tr:gt(0)").remove();for(var c=0;c<b.data.length;c++){var d="<tr>";b.noAdd&&b.noDel&&b.noSave||(d+='<th><input class="form-control" type="checkbox" name="id" /></th>');for(var h=0;h<b.data[c].length;h++)if("textarea"==b.typeConfig[h].type)d+='<td style="cursor: pointer">'+b.data[c][h].substr(0,10)+'......<input type="hidden" value="'+m.encode(b.data[c][h])+'" /></td>';else if("select"==b.typeConfig[h].type)for(var g=0;g<b.typeConfig[h].options.length;g++){if(b.typeConfig[h].options[g][0]==b.data[c][h]){d+='<td   style="cursor: pointer">'+b.typeConfig[h].options[g][1]+"</td>";break}}else d+='<td   style="cursor: pointer">'+b.data[c][h]+"</td>";0==b.noOperator&&(d+=b.operatorHTML);d+="</tr>";a(k).children().eq(0).append(d);a('[data-toggle="tooltip"]').tooltip()}}function e(){a("#pagination").html("");if(1<b.totalPage){for(var c='<ul class="pagination">',d=1;d<=b.totalPage;d++)c=d==b.currentPage||-1==b.currentPage&&1==d?c+('<li class="disabled"><a href="javascript:;">'+d+"</a></li>"):c+('<li><a href="javascript:;">'+d+"</a></li>");c+="</ul>";a("#pagination").html(c)}}var b=a.extend({},{"class":"table table-hover",title:[],data:[],delsURL:"",saveURL:"",addURL:"",paginationURL:"",typeConfig:[],titleConfig:[],noSave:!1,noDel:!1,noAdd:!1,noOperator:!0,operatorHTML:"",currentPage:-1,totalPage:-1},l),m=new n,k=a(this);a(this).append("<tbody></tbody>");a(this).addClass("table table-bordered table-condensed ");(function(){var c="<tr>";b.noAdd&&b.noDel&&b.noSave||(c+='<th><input class="form-control" type="checkbox" name="ids" /></th>');for(var d=0;d<b.title.length;d++){for(var h=!1,g=0;g<b.titleConfig.length;++g)if(b.titleConfig[g].title==b.title[d]&&(h=!0,c+='<th><a tabindex="0" data-trigger="focus" class="btn btn-link" datadata-placement="bottom"  role="button" data-toggle="popover" title="\u7b5b\u9009" data-content="',"select"==b.titleConfig[g].type)){for(var e=0;e<b.titleConfig[g].value.length;++e)c+="<label><input type='radio'  name='radio' value='"+b.titleConfig[g].value[e]+"'> "+b.titleConfig[g].options[e]+"</label><br/>";c+='">'+b.title[d]+"</a></th>"}h||(c+="<th>"+b.title[d]+"</th>")}0==b.noOperator&&(c+="<th>\u64cd\u4f5c</th>");c+="</tr>";a(k).children().eq(0).append(c)})();a(this).on("change",":radio",function(){});f();a(this).on("dblclick","td",function(){var c=a(this).parent().find("td").index(a(this)[0]),d=a(this).parent().parent().find("tr").index(a(this).parent()[0]);if(0!=b.typeConfig[c].edit)if("text"==b.typeConfig[c].type)-1==a(this).html().indexOf("input")&&a(this).html('<input type="text" onkeypress="if(event.which == 13)$(this).parent().html($(this).val());" value="'+a(this).html()+'" class="form-control"/>');else if("select"==b.typeConfig[c].type){if(-1==a(this).html().indexOf("<select")){var h=a(this).html();a(this).html('<select class="form-control" onchange="$(this).parent().html($(this).find(\'option:selected\').text());"></select>');for(d=0;d<b.typeConfig[c].options.length;d++)b.typeConfig[c].options[d][1]==h?a(this).children().eq(0).append('<option selected value="'+b.typeConfig[c].options[d][0]+'">'+b.typeConfig[c].options[d][1]+"</option>"):a(this).children().eq(0).append('<option value="'+b.typeConfig[c].options[d][0]+'">'+b.typeConfig[c].options[d][1]+"</option>")}}else"textarea"==b.typeConfig[c].type&&(h=m.decode(a(this).children().eq(0).val()),a("#longTextRow").val(d),a("#longTextCel").val(c),a("#longTextModal textarea").val(h),a("#longTextModal").modal())});a(this).on("blur",":text",function(){a(this).parent().html(a(this).val())});a(this).on("click",":checkbox[name='id']",function(){1==a(this).prop("checked")?a(this).parent().parent().addClass("active"):a(this).parent().parent().removeClass("active")});a(this).on("click",":checkbox[name='ids']",function(){1==a(this).prop("checked")?(a(":checkbox[name='id']").prop("checked",!0),a(k).children().eq(0).children("tr:gt(0)").addClass("active")):(a(":checkbox[name='id']").prop("checked",!1),a(k).children().eq(0).children("tr:gt(0)").removeClass("active"))});a(function(){a('[data-toggle="popover"]').popover({html:!0})});a(this).after("<hr />");b.noAdd||a(this).after(' <button class="btn btn-primary add" type="button"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> \u65b0\u589e\u6570\u636e</button>');b.noDel||a(this).after('<button class="btn btn-danger dels"  type="button"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> \u5220\u9664\u9009\u4e2d\u6570\u636e</button> ');b.noSave||a(this).after('<button class="btn btn-default saves"  type="button"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"> \u4fdd\u5b58\u9009\u4e2d\u6570\u636e</span></button> ');a(this).after('<nav aria-label="Page navigation" class="text-right" id="pagination"></nav>');e();a("#pagination").on("click","li",function(){if(!a(this).hasClass("disabled")){var c=a(this).children().eq(0).html();a(this).html('<span class="glyphicon glyphicon-refresh"></span>');a.get(b.paginationURL+"?currentPage="+c,function(c){1==c.status?(b.data=c.data,b.currentPage=c.currentPage,b.totalPage=c.totalPage,f(),e()):(a("#alertInfo").html("\u8bf7\u6c42\u5931\u8d25!!!"),a("#alertInfo").modal())})}});a(".dels").click(function(){var c=[];a(":checkbox[name='id']").each(function(){a(this).prop("checked")&&c.push(a(this).parent().next().html())});0!=c.length&&a.post(b.delsURL,{ids:c},function(b){if(1==b.status){for(var c=0;c<b.ids.length;c++)a(k).children().eq(0).children().each(function(){a(this).children().eq(1).html()==b.ids[c]&&a(this).remove()});a("#alertInfo").html("\u5220\u9664\u6210\u529f");a("#alertModal").modal();window.setTimeout('$("#alertModal").modal("hide")',2E3)}else a("#alertInfo").html("\u5220\u9664\u5931\u8d25"),a("#alertModal").modal()})});a(".saves").click(function(){var c=[];a(":checkbox[name='id']").each(function(){if(a(this).prop("checked")){for(var d=a(this).parent().parent(),e=[],g=1;g<a(d).children().length-1;g++)if(0==b.typeConfig[g-1].edit)e.push(a(d).children().eq(g).html());else if("text"==b.typeConfig[g-1].type)e.push(a(d).children().eq(g).html());else if("select"==b.typeConfig[g-1].type)for(var f=0;f<b.typeConfig[g-1].options.length;f++)a(d).children().eq(g).html()==b.typeConfig[g-1].options[f][1]&&e.push(b.typeConfig[g-1].options[f][0]);else"textarea"==b.typeConfig[g-1].type&&e.push(m.decode(a(d).children().eq(g).children().eq(0).val()));c.push(e)}});0!=c.length&&a.post(b.saveURL,{infos:c},function(a){})});a(".add").click(function(){a("#addForm").html("");for(var c=1;c<b.title.length;c++)if("text"==b.typeConfig[c].type)a("#addForm").append('<div class="form-group"><label class="col-sm-4 control-label">'+b.title[c]+'</label><div class="col-sm-6"><input type="text" value="" class="form-control"/></div></div>');else if("select"==b.typeConfig[c].type){a("#addForm").append('<div class="form-group"><label class="col-sm-4 control-label">'+b.title[c]+'</label><div class="col-sm-6"><select class="form-control"></select></div></div>');for(var d=0;d<b.typeConfig[c].options.length;d++)a("#addForm").children().last().children().eq(1).children().eq(0).append('<option selected value="'+b.typeConfig[c].options[d][0]+'">'+b.typeConfig[c].options[d][1]+"</option>")}else"textarea"==b.typeConfig[c].type&&a("#addForm").append('<div class="form-group"><label class="col-sm-4 control-label">'+b.title[c]+'</label><div class="col-sm-6"><textarea class="form-control" rows="10"></textarea></div></div>');a("#addModal").modal()});a("body").append('<div id="alertModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="alertModalLabel">  <div class="modal-dialog modal-sm" role="document">    <div class="modal-content">     <div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>   \u63d0\u9192     </div>     <div class="modal-body" ><p id="alertInfo" class="text-center text-danger"></p>     </div>      </div>  </div></div>');a("body").append('<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h4 class="modal-title" id="addModalLabel">\u65b0\u589e\u4e00\u7ec4\u6570\u636e</h4>\n            </div>\n            <div class="modal-body">\n                <form class="form-horizontal" id="addForm">\n\n                </form>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default" data-dismiss="modal">\u5173\u95ed</button>\n                <button type="button" class="btn btn-primary" id="save">\u4fdd\u5b58</button>\n            </div>\n        </div>\n    </div>\n</div>');a("body").append('<div class="modal fade" id="longTextModal" tabindex="-1" role="dialog" aria-labelledby="longTextModalLabel">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h4 class="modal-title">\u7f16\u8f91\u957f\u6587\u672c</h4>\n            </div>\n            <div class="modal-body">\n<textarea class="form-control" cols="10" rows="20"></textarea><input type="hidden" id="longTextRow" /><input type="hidden" id="longTextCel" />            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default" data-dismiss="modal">\u5173\u95ed</button>\n                <button type="button" class="btn btn-primary" data-dismiss="modal" id="saveLongText">\u4fdd\u5b58</button>\n            </div>\n        </div>\n    </div>\n</div>');a("#save").click(function(){var c=[];a("#addForm .text-danger").remove();for(var d=0;d<a("#addForm").children().length;d++){var e=a("#addForm").children().eq(d).children().eq(1).children().eq(0);c[d]=a(e).val()}a.post(b.addURL,{info:c},function(b){if(1!=b.status)for(var c=0;c<b.errors.length;c++)a("#addForm").children().eq(b.errors[c][0]).children().eq(1).append('<p class="text-danger">'+b.errors[c][1]+"</p>")})});k=a(this);a("#saveLongText").click(function(){var b=a("#longTextModal textarea").val().substr(0,10)+'......<input type="hidden" value="'+m.encode(a("#longTextModal textarea").val())+'"/>';a(k).children().eq(0).children().eq(a("#longTextRow").val()).children().eq(parseInt(a("#longTextCel").val())+1).html(b)})}})(jQuery);